<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCW and FWRC Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- https://bootstrappretty.dev/palettes/dracula/ -->
    <link rel="stylesheet" href="dracula-theme.css">
    <style>
        

        body {
            display: flex;
            height: 100vh;
            /* background-color: var(--bs-dark-bg-subtle); */
        }
        /* body[data-bs-theme="light"] {
            background-color: #ffffff;
            color: #000000;
        }
        body[data-bs-theme="dark"] {
            background-color: #121212;
            color: #ffffff;
        } */

        #logo {
            /* background-color: var(--bs-dark-bg-subtle); */
        }
        #sidebar {
            width: 100%;
            max-width: 300px;
            min-width: 300px;
            /* background-color: #f8f9fa; */
            padding: 0;
            overflow-y: auto;
            
        }
        #sidebar.border-end  {
            border:none!important;
            border-color: var(--bs-light-bg-subtle)!important;
        }
        #content {
            flex-grow: 1;
            padding: 1rem;
            
            overflow-y: auto;
        }
        #accordion-menu {
            padding:10px;
            
        }
        #accordion-menu > .accordion-item:first-of-type .accordion-button {
            border-top-left-radius: var(--bs-accordion-inner-border-radius);
            border-top-right-radius: var(--bs-accordion-inner-border-radius);
            /* border-bottom-left-radius: var(--bs-accordion-inner-border-radius);
            border-bottom-right-radius: var(--bs-accordion-inner-border-radius); */
            
            
        }
        #accordion-menu .accordion-button,
        #accordion-menu .accordion-button:focus,
        #accordion-menu .accordion-button:hover,
        #accordion-menu.accordion-button.collapsed,
        #accordion-menu.accordion-button:not(.collapsed) {
            box-shadow: none !important;
        }
        #accordion-menu > .accordion-item  .accordion-button.collapsed{
            background-color: var(--bs-light-bg-subtle);
            border:0;
            
        }

        .accordion-item {
            border: 0;
            margin-bottom: 1px;
               
            
        }
        .accordion-button {
            /* width: 100%;
            padding: 0.75rem 1rem; */
            
            /* box-shadow: inset 0 calc(-1* var(--bs-accordion-border-width)) 0 var(--bs-accordion-border-color); */
            
        }
        
        

        

        #accordion-menu .accordion-item .accordion-item .accordion-button {
            background-color: var(--bs-light-bg-subtle);
            border:0;
            border-radius: 0;

        }
        #sidebar .list-group-item {
            
            background-color: rgba(0,0,0,.05);
        }

        #sidebar .list-group-item {
            word-wrap: break-word;
            white-space: normal;
            background-color: none;
            padding: var(--bs-accordion-btn-padding-y) var(--bs-accordion-btn-padding-x);
            font-size: 1rem;
            color: var(--bs-accordion-btn-color);
        }
        .rcw-num, .dir-num, .nav-item-num {
            margin-right: 0.5rem;
        }

        .accordion-header.checked-header .accordion-button, .accordion-header.checked-header .accordion-button-page  {
    font-weight: bold;
    color: var(--bs-danger); /* You can choose any color or style */
}

        /* Minimalistic card style */
        /* .rcw-card .card {
            border: none;
            border-left: 2px solid #e9ecef;
            padding: 1rem 1.5rem;
            background-color: #f9f9f9;
            margin-bottom: 1rem;
        }
        .rcw-card .card-body {
            padding: 0;
        }
        .rcw-card .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .rcw-card .offense-badge {
            font-size: 0.85rem;
            padding: 0.5em 0.75em;
            color: #fff;
            background-color: #6c757d;
            border-radius: 5px;
        }
        .rcw-card hr {
            margin: 0.75rem 0;
            color: #ddd;
        }
        .rcw-card .label {
            display: inline-block;
            font-size: 0.9rem;
            color: #495057;
            background-color: #e9ecef;
            padding: 0.3em 0.6em;
            margin: 0.2em 0;
            border-radius: 3px;
        }
        .rcw-card .questions-column {
            border-left: 2px solid #e9ecef;
            padding-left: 1rem;
        }
        .rcw-card .questions-column h6 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .rcw-card .question-item {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        } */

        /* [data-bs-theme=dark] body {
            color: var(--bs-primary-text-emphasis);
            background-color: var(--bs-primary-bg-subtle);
            } */
/* width */


html[data-bs-theme="dark"] ::-webkit-scrollbar { width: 10px; }
html[data-bs-theme="dark"] ::-webkit-scrollbar-track { background: var(--bs-dark); }
html[data-bs-theme="dark"] ::-webkit-scrollbar-thumb { background: var(--bs-primary-border-subtle); }
html[data-bs-theme="dark"] ::-webkit-scrollbar-thumb:hover { background: var(--bs-dark-border-subtle); }



.accordion-button-page {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
    padding: var(--bs-accordion-btn-padding-y) var(--bs-accordion-btn-padding-x);
    font-size: 1rem;
    color: var(--bs-accordion-btn-color);
    text-align: left;
    background-color: var(--bs-light-bg-subtle);
    border: 0;
    border-radius: 0;
    overflow-anchor: none;
    transition: var(--bs-accordion-transition);
}


.list-bullet {
    width: 32px; 
    height: 32px; 
    font-weight: bold;
}
html[data-bs-theme="light"] .list-bullet {
    color: var(--bs-secondary);
    background-color: rgba(var(--bs-light-rgb)) !important;
}



    </style>
        

</head>
<body>

    
  
    <!-- Sidebar -->
    <!-- Sidebar -->
<nav id="sidebar" class="border-end">
  <h4 id="logo" class="p-3 mb-0"><i class="bi bi-emoji-dizzy"></i> CallReady
    <div class="form-check form-switch d-inline-flex fs-6 float-end mt-1">
        <input class="form-check-input" type="checkbox" id="themeToggle" checked>
        <label class="form-check-label ms-2" for="themeToggle"><i class="bi bi-moon-stars"></i></label>
    </div>
</h4>
  

  <div class="accordion" id="accordion-menu">
      <!-- RCW Codes Section -->
      <div class="accordion-item">
          <h2 class="accordion-header" id="headingRCW">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRCW">
                <i class="bi bi-emoji-grimace fs-5 me-3"></i> Crimes
              </button>
          </h2>
          <div id="collapseRCW" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
              <div class="accordion-body p-0" id="rcwList">
                  <!-- RCW Chapters will populate here -->
              </div>
          </div>
      </div>

      <!-- RCW Traffic Codes Section -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTrafficRCW">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTrafficRCW">
                <i class="bi bi-stoplights fs-5 me-3"></i> Traffic
            </button>
        </h2>
        <div id="collapseTrafficRCW" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
            <div class="accordion-body p-0" id="rcwTrafficList">
                <!-- RCW Chapters will populate here -->
            </div>
        </div>
    </div>

      
      <!-- FWRC Codes Section -->
      <div class="accordion-item">
          <h2 class="accordion-header" id="headingFWRC">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFWRC">
                <i class="bi bi-buildings fs-5 me-3"></i> FWRC
              </button>
          </h2>
          <div id="collapseFWRC" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
              <div class="accordion-body p-0" id="fwrcList">
                  <!-- FWRC Chapters will populate here -->
              </div>
          </div>
      </div>
      <!-- Call Types Section -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingCallTypes">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCallTypes">
                <i class="bi bi-clipboard2-check fs-5 me-3"></i> Calls
            </button>
        </h2>
        <div id="collapseCallTypes" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
            <div class="accordion-body p-0" id="callTypeList">
                <!-- CallTypes will populate here -->
            </div>
        </div>
    </div>
    <!-- Directory Section -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingDirectory">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDirectory">
                <i class="bi bi-journals fs-5 me-3"></i> Directory
            </button>
        </h2>
        <div id="collapseDirectory" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
            <div class="accordion-body p-0" id="directoryList">
                <!-- Directory will populate here -->
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingPages">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePages">
                <i class="bi bi-columns fs-5 me-3"></i> Pages
            </button>
        </h2>
        <div id="collapsePages" class="accordion-collapse collapse" data-bs-parent="#accordion-menu">
            <div class="accordion-body p-0" id="pageList">
                <!-- Pages will populate here -->
            </div>
        </div>
    </div>
  </div>
  <div class="d-grid gap-2 col-11 mx-auto">
    <button id="clearSelections" class="btn bg-light-subtle text-light"><i class="bi bi-x-square"></i> Clear All</button>

  </div>

</nav>

    <!-- Toast -->
    <div class="toast-container bottom-0 end-0 p-3">
  
      <div class="toast text-bg-primary border-0" role="alert">
        <div class="toast-header">
            <i class="bi bi-info-circle me-2"></i>
            <strong class="me-auto">TIP</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
          Never "Code-4" before running a name. 
        </div>
      </div>
    </div>


    <!-- Main Content Area -->
    <div id="content">
        <div id="rcwCards" class="row">
            <!-- RCW and FWRC cards will populate here -->
        </div>
    </div>
    <!-- <div id="contentTest" class="fs-6 font-monospace"></div> -->
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    

    
    <!-- Import JSON data for RCW and FWRC datasets -->
    
    <script src="rcwData.js"></script>
    <script src="fwrcData.js"></script>
    <script src="callTypes.js"></script>
    <script src="directory.js"></script>
    <script src="pages.js"></script>
    
    <!-- JavaScript to Generate Sidebar and Cards -->
    <script>


/* This section handles dynamic page content functions */




function handleDynamicPageTriggers(container) {
    const observer = new MutationObserver((mutationsList) => {
        mutationsList.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
                if (node.nodeType === 1 && node.dataset && node.dataset.trigger) {
                    const trigger = node.dataset.trigger;
                    //console.log(`Triggered function: ${trigger}`);
                    if (typeof window[trigger] === "function") {
                        window[trigger]();
                    } else {
                        //console.warn(`Function ${trigger} is not defined.`);
                    }
                } else if (node.nodeType === 1) {
                    const triggers = node.querySelectorAll("[data-trigger]");
                    triggers.forEach((triggerNode) => {
                        const trigger = triggerNode.dataset.trigger;
                        //console.log(`Triggered function: ${trigger}`);
                        if (typeof window[trigger] === "function") {
                            window[trigger]();
                        } else {
                            //console.warn(`Function ${trigger} is not defined.`);
                        }
                    });
                }
            });
        });
    });

    observer.observe(container, { childList: true, subtree: true });
    console.log("Observer attached to container for dynamic content.");
}

// Example global functions to trigger
    function refreshCourtDates() {
        //console.log("refreshCourtDates executed!");

        const cdTable = document.getElementById("courtDates");
        cdTable.innerHTML = `
            <li class=\"list-group-item d-flex justify-content-between\"><strong>In Custody</strong> ${scheduler.getDate("custody")}</li>
            <li class=\"list-group-item d-flex justify-content-between\"><strong>In Custody DUI</strong> ${scheduler.getDate("dui")}</li>
            <li class=\"list-group-item d-flex justify-content-between\"><strong>Criminal Citation</strong> ${scheduler.getDate("traffic")}</li>
            <li class=\"list-group-item d-flex justify-content-between\"><strong>Traffic Infracion</strong> ${scheduler.getDate("criminal")}</li>

        `;

        // const custodyDT = scheduler.getDate("custody");
        // const duiDT = scheduler.getDate("dui");
        // const trafficDT = scheduler.getDate("traffic");
        // const criminalDT = scheduler.getDate("criminal");

        // console.log(custodyDT); // Next judicial day at 08:30
        // console.log(duiDT); // Next judicial day at 14:30
        // console.log(trafficDT); // 30 Days from now
        // console.log(criminalDT);
    }




// Target container where dynamic HTML will be added
const rcwCards = document.getElementById('rcwCards');
handleDynamicPageTriggers(rcwCards);



/* END DYNAMIC PAGE CONTENT FUNCTION */




class DateScheduler {
    constructor() {
        this.judicialHours = {
            custody: "08:30",
            dui: "13:15"
        };
        this.timezone = "America/Los_Angeles"; // Correct IANA timezone for Pacific Time
    }

    // Initialize scheduler (can be used for additional setup in the future)
    init() {
        console.log("DateScheduler initialized with timezone:", this.timezone);
    }

    // Helper function to check if a given date is a judicial day (Monday-Friday)
    isJudicialDay(date) {
        const day = date.getDay(); // 0 = Sunday, 6 = Saturday
        return day >= 1 && day <= 5;
    }

    // Format date to "MM/DD/YYYY HH:mm"
    formatDateTime(date, time) {
        const options = {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            timeZone: this.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone
        };
        const dateString = date.toLocaleDateString("en-US", options);
        return `${dateString} ${time}`;
    }

    // Main function to calculate court date
    calculate(type, currentDate = new Date()) {
        const resultDate = new Date(currentDate);

        switch (type.toLowerCase()) {
            case 'custody':
            case 'dui':
                // Move to the next judicial day
                do {
                    resultDate.setDate(resultDate.getDate() + 1);
                } while (!this.isJudicialDay(resultDate));
                return this.formatDateTime(resultDate, this.judicialHours[type.toLowerCase()]);

            case 'traffic':
                // Add 30 days for traffic infractions
                resultDate.setDate(resultDate.getDate() + 30);
                return this.formatDateTime(resultDate, "23:59"); // Default time

            case 'criminal':
                // Move to the second Tuesday from the current date
                let tuesdayCount = 0;
                while (tuesdayCount < 2) {
                    resultDate.setDate(resultDate.getDate() + 1);
                    if (resultDate.getDay() === 2) { // 2 = Tuesday
                        tuesdayCount++;
                    }
                }
                return this.formatDateTime(resultDate, "08:30");

            default:
                throw new Error("Invalid type. Valid types are 'custody', 'dui', 'traffic', or 'criminal'.");
        }
    }

    // Overloading the object for direct function call
    getDate(type, currentDate) {
        return this.calculate(type, currentDate);
    }
}

// Example Usage:
const scheduler = new DateScheduler();
scheduler.init();





// Use example: keyExists(obj,'notes')
// Will check if the key is in the object and if there is a value. 
function keyExists(obj, key) {
    return obj[key] && typeof obj[key] === "string" && obj[key].trim().length > 0;
}


function clearPages() {
    const rcwPages = rcwCards.querySelectorAll('.rcw-page');

    // Remove each element with the class "rcw-page"
    rcwPages.forEach(rcwPage => {
        rcwPage.remove();
    });
}





const directoryList = document.getElementById('directoryList');
directory.forEach((category, index) => {
    const contactItem = document.createElement('div');
    contactItem.classList.add('accordion-item');    
    contactItem.innerHTML = `
        <h2 class="accordion-header " id="headingDir${category.id}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDir${category.id}">
                <span class="dir-num badge border border-secondary-subtle text-secondary fs-6">${category.id}</span>
                <span class="dir-title">${category.category}</span>
            </button>
        </h2>
        <div id="collapseDir${category.id}" class="accordion-collapse collapse">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    ${category.contacts.map(item => `
                        <li class="list-group-item d-flex align-items-center border-0">
                            <input type="checkbox" id="cb-dir-${item.id}" data-dir='${JSON.stringify(item)}' class="form-check-input me-2 dir-checkbox" />
                            <label for="cb-dir-${item.id}" class="form-check-label fw-lighter">${item.name}</label>
                        </li>
                    `).join('')}
                </ul>
            </div>
        </div>
    `;
    directoryList.appendChild(contactItem);

});



const pageList = document.getElementById('pageList');
pages.forEach((page, index) => {
    const navItem = document.createElement('div');
    //console.log(page);
    navItem.classList.add('accordion-item');    
    navItem.innerHTML = `
        <h2 class="accordion-header" id="heading-page-${page.id}">
            <button class="accordion-button-page" data-page="${page.id}">
                <span class="nav-item-num badge border border-secondary-subtle text-secondary fs-6">${page.id}</span>
                <span class="nav-item-title">${page.title}</span>
            </button>
        </h2>
    `;
    pageList.appendChild(navItem);

});



        // Populate RCW Codes in the Sidebar
const rcwList = document.getElementById('rcwList');
codes.chapters.forEach((chapter, index) => {
    const chapterItem = document.createElement('div');
    chapterItem.classList.add('accordion-item');

    chapterItem.innerHTML = `
        <h2 class="accordion-header" id="headingRCW${index}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRCW${index}">
                <span class="rcw-num badge border border-secondary-subtle text-secondary fs-6">${chapter.id}</span>
                <span class="rcw-title">${chapter.title}</span>
            </button>
        </h2>
        <div id="collapseRCW${index}" class="accordion-collapse collapse">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    ${chapter.items.map(item => `
                        <li class="list-group-item d-flex align-items-center border-0">
                            <input type="checkbox" id="${item.id}" data-rcw='${JSON.stringify(item)}' class="form-check-input me-2 rcw-checkbox" />
                            <label for="${item.id}" class="form-check-label fw-lighter">${item.title}</label>
                        </li>
                    `).join('')}
                </ul>
            </div>
        </div>
    `;
    rcwList.appendChild(chapterItem);
});

const rcwTrafficList = document.getElementById('rcwTrafficList');
trafficCodes.chapters.forEach((chapter, index) => {
    const chapterItem = document.createElement('div');
    chapterItem.classList.add('accordion-item');

    chapterItem.innerHTML = `
        <h2 class="accordion-header" id="headingRCW${index}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTrafficRCW${index}">
                <span class="rcw-num badge border border-secondary-subtle text-secondary fs-6">${chapter.id}</span>
                <span class="rcw-title">${chapter.title}</span>
            </button>
        </h2>
        <div id="collapseTrafficRCW${index}" class="accordion-collapse collapse">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    ${chapter.items.map(item => `
                        <li class="list-group-item d-flex align-items-center border-0">
                            <input type="checkbox" id="${item.id}" data-rcw='${JSON.stringify(item)}' class="form-check-input me-2 rcwtraffic-checkbox" />
                            <label for="${item.id}" class="form-check-label fw-lighter">${item.title}</label>
                        </li>
                    `).join('')}
                </ul>
            </div>
        </div>
    `;
    rcwTrafficList.appendChild(chapterItem);
});

// Populate FWRC Codes in the Sidebar
const fwrcList = document.getElementById('fwrcList');
fwrcData.chapters.forEach((chapter, index) => {
    const chapterItem = document.createElement('div');
    chapterItem.classList.add('accordion-item');

    chapterItem.innerHTML = `
        <h2 class="accordion-header " id="headingFWRC${index}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFWRC${index}">
                <span class="rcw-num badge border border-secondary-subtle text-secondary fs-6">${chapter.id}</span>
                <span class="rcw-title">${chapter.title}</span>
            </button>
        </h2>
        <div id="collapseFWRC${index}" class="accordion-collapse collapse">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    ${chapter.items.map(item => `
                        <li class="list-group-item d-flex align-items-center border-0">
                            <input type="checkbox" id="${item.id}" data-fwrc='${JSON.stringify(item)}' class="form-check-input me-2 fwrc-checkbox" />
                            <label for="${item.id}" class="form-check-label fw-lighter">${item.title}</label>
                        </li>
                    `).join('')}
                </ul>
            </div>
        </div>
    `;
    fwrcList.appendChild(chapterItem);
});

// Populate FWRC Codes in the Sidebar
const callTypeList = document.getElementById('callTypeList');
callTypeData.chapters.forEach((chapter, index) => {
    const chapterItem = document.createElement('div');
    chapterItem.classList.add('accordion-item');

    chapterItem.innerHTML = `
        <h2 class="accordion-header" id="headingCallTypes${index}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCallTypes${index}">
                <span class="rcw-num  badge border border-secondary-subtle text-secondary fs-6">${chapter.id}</span>
                <span class="rcw-title">${chapter.title}</span>
            </button>
        </h2>
        <div id="collapseCallTypes${index}" class="accordion-collapse collapse">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    ${chapter.items.map(item => `
                        <li id="li-${item.id}" class="list-group-item d-flex align-items-center border-0">
                            <input type="checkbox" id="${item.id}" data-calltype='${JSON.stringify(item)}' class="form-check-input me-2 calltype-checkbox" />
                            <label for="${item.id}" class="form-check-label fw-lighter">${item.title}</label>
                        </li>


                    `).join('')}
                </ul>
            </div>
        </div>
    `;
    callTypeList.appendChild(chapterItem);
});





     // Global event listener for checkbox change events to manage cards and header styling
document.addEventListener('change', (event) => {
    const checkbox = event.target;
    
    // Check if the change event is from a relevant checkbox
    if (checkbox.classList.contains('rcw-checkbox') || 
    checkbox.classList.contains('rcwtraffic-checkbox') || 
    checkbox.classList.contains('fwrc-checkbox') || 
        checkbox.classList.contains('calltype-checkbox') ||
        checkbox.classList.contains('dir-checkbox') 
    ) {

        // Determine data attribute based on checkbox class
        let dataType;

        if (checkbox.classList.contains('rcw-checkbox')) {
            dataType = 'rcw';
        } else if (checkbox.classList.contains('rcwtraffic-checkbox')) {
            dataType = 'rcw';
        }else if (checkbox.classList.contains('fwrc-checkbox')) {
            dataType = 'fwrc';
        } else if (checkbox.classList.contains('calltype-checkbox')) {
            dataType = 'calltype';
        } else if (checkbox.classList.contains('dir-checkbox')) {
            dataType = 'dir';
        } else {
            dataType = 'calltype';
        }

        const dataAttr = checkbox.getAttribute(`data-${dataType}`);
        const data = JSON.parse(dataAttr);


        //console.log('******************** dataType');
        //console.log(dataType);


        // Add or remove card based on checkbox state
        switch (dataType) {
            case 'rcw':
            case 'fwrc':
            case 'calltype':
            checkbox.checked ? addCodeCard(data) : removeCodeCard(data.id);
                break;
            case 'dir':
            checkbox.checked ? addDirCard(data) : removeDirCard(data.id);
                break;
            default:
                console.log('No DataType specified.');
                break;
        }
        



        // Update accordion header styling based on any checked items in the section
        const accordionBody = checkbox.closest('.accordion-collapse');
        const accordionHeader = accordionBody.previousElementSibling;
        const anyChecked = Array.from(accordionBody.querySelectorAll('input[type="checkbox"]')).some(cb => cb.checked);

        // Toggle styling for accordion header
        accordionHeader.classList.toggle('checked-header', anyChecked);
    }
});


// Event listener for list item click to toggle checkbox state
document.querySelectorAll('.list-group-item').forEach(item => {
    item.addEventListener('click', (event) => {
        const checkbox = item.querySelector('input[type="checkbox"]');
        const label = item.querySelector('label');

        // Toggle checkbox only if click is outside both the checkbox and its label
        if (event.target !== checkbox && event.target !== label) { 
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change', { bubbles: true }));
        }
    });
});


document.getElementById('clearSelections').addEventListener('click', function () {
    // Uncheck all checkboxes
    document.querySelectorAll('.list-group-item input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
        checkbox.dispatchEvent(new Event('change', { bubbles: true })); // Trigger 'change' event for each checkbox
    });

    // Clear all cards
    
    rcwCards.innerHTML = '';
});





function parseDefinitions(item) {
  // Check if 'definition' exists and is an array
  var str = '';
  if (item.definition && Array.isArray(item.definition)) {
    // Begin list group container
    str += `<div class="list-group">`;
      
    item.definition.forEach(def => {
      // Create each list item with index as a placeholder for icon
      console.log(def);

      const href = (def.hasOwnProperty("href"))?def.href:"#";
      const isLink = (href !== '#')?true:false;

      str += `<a href="${href}" class="btn-jump list-group-item list-group-item-action d-flex gap-3 py-3 ${(isLink)?"text-bg-primary":""}">`;
      str += `<div class="rounded-circle list-bullet flex-shrink-0 d-flex align-items-center justify-content-center ${(isLink)?"bg-primary-subtle":"bg-secondary"}">${def.index}</div>`;
      str += `<div class="d-flex gap-2 w-100 justify-content-between">`;
      
      // Display the main content with indentation
      str += `<div>`;
      str += `<p class="mb-0 opacity-75 definition-main">${def.main}</p>`;

      // Check if there are subsections and add them as a nested list
      if (def.subSections && Array.isArray(def.subSections) && def.subSections.length > 0) {
        str += `<ul class="mt-2">`; // Indent the list for subsections
        def.subSections.forEach(subSec => {
          str += `<li class="opacity-75">${wrapAlphabeticalTags(subSec)}</li>`;
        });
        str += `</ul>`;
      }

      

      str += `</div>`;
      str += `</div>`;
      if(isLink){
        str += `<i class="bi bi-caret-right-fill float-end"></i>`;
      }
      str += `</a>`;
    });
    
    // Close list group container
    str += `</div>`;
    return str;
  } else {
    console.warn("No valid definitions found for item:", item);
    return str;
  }
}





var procedures = {
    facePage: {
        title: 'Spillman Face Page',
        description: 'A face page is required when a case number is created or a crime has occurred. Another instance that may require a facepage is when something of importance needs to be documented. I call this a CYA (Cover your ass) report.',
        link: ''
    },
    witnessStatements: {
        title: 'Witness Statements',
        description: 'Witness statement forms are most necessary on felony related crimes. ',
        link: ''
    },
    dvSupplementalForm: {
        title: 'DV Supplemental Form',
        description: 'All DV cases involving a crime require a DV Sup Form.',
        link: ''
    },
    strangulationForm: {
        title: 'Strangulation Form',
        description: 'Any time someone says they were strangled, a Strangulation Form is required.',
        link: ''
    },
    fireDispatch: {
        title: 'Dispatch Fire',
        description: 'Fire dept. cannot arrive on scene until Dispatch knows the scene is Code-4. You can ask Dispatch to stage fire if you know someone will need them.',
        link: ''
    },
    IIICheck: {
        title: 'III Check',
        description: 'On the 3rd DV, DUI, Order Violation, or Assault Charge, a Misdemeanor becomes a FELONY. Call records and ask them to perform a III Check on the suspect.',
        link: ''
    },
    bookForDestruction: {
        title: 'Book for Destruction',
        description: 'Package and submit to evidence departmemnt for destruction.',
        link: ''
    },
    SFST: {
        title: 'Field Sobriety Test',
        description: 'Done from department issued SFST card.',
        link: ''
    },
    BloodWarrant: {
        title: 'Blood Warrant',
        description: 'Warrant must be approved before blood draw from hospital.',
        link: ''
    },
    EvidenceTow: {
        title: 'Evidence Tow',
        description: 'MV Towing - Will tow to FWPD. Search warrant required.',
        link: ''
    },
    Code4: {
        title: 'Code-4',
        description: 'Code-4 after ensuring you know who you&apos;re dealing with. Log ID first.',
        link:''
    },
    HighRiskStop: {
        title: 'High-Risk Stop',
        description: 'Code 1 or 2. Find Cover, Bring suspect to \"The Known\". Slow things down.',
        link:''
    }
             
              
}

function wrapAlphabeticalTags(input) {
    if (!input) return input; // Return unchanged if input is empty or undefined.

    return input.replace(/\((?:[a-z]+|i{1,3}|iv|v|vi{0,3}|ix|x{0,3})\)/g, function (match) {
        return `<strong class=\"text-primary\">${match}</strong>`;
    });
}


           


function offenseColor(offense) {
    var color = 'secondary-subtle';
    switch (offense) {
        case 'Class A Felony':
        case 'Class B Felony':
        case 'Class C Felony':
            color = 'danger';
            break;
        case 'Gross Misdemeanor':
            color = 'warning';
            break;
        case 'Misdemeanor':
            color = 'secondary';
            break;
        default:
        color = 'secondary-subtle';
            break;
    }
    return color; 
}


    // Helper Functions
    function generateSection(title, items, formatter, listClass = 'list-group list-group-flush') {
        if (!items || items.length === 0) return '';
        return `
        <h5 class="mb-3">${title}</h5>
        <ul class="${listClass} mb-4">
            ${items.map(formatter).join('')}
        </ul>`;
    }

    function formatListItem(item) {
        return `<li class="list-group-item">${item}</li>`;
    }

    function formatProcedure(procedureId, index) {
        console.log('*******formatProcedure');
        console.log(procedureId);
        if(procedureId !== ''){
            const procedure = procedures[procedureId];
        if (!procedure) return '';
            return `
        <li class="list-group-item" data-bs-toggle="collapse" data-bs-target="#collapse-relatedproc-${index}">
            ${procedure.title}
            <div class="collapse" id="collapse-relatedproc-${index}">
                <div class="card card-body border-0">
                    ${procedure.description}
                </div>
            </div>
        </li>`;
        }
        
    }

        // Function to add a card for RCW or FWRC
        function addCodeCard(data) {
            //console.log('data ********************************');
            //console.log(data);

            clearPages();

            const card = document.createElement('div');
            card.classList.add('col-12', 'rcw-card', 'mb-3');
            card.setAttribute('data-id', data.id);
           
            var cardContent = `
                <div class="card container border-1 border-${offenseColor(data.offense)} shadow-sm rounded-4">
                    <div class="row">

                        <!-- Left Column -->
                        <div class="col-8">
                            <div class="card-body p-5">
                                ${data.offense ? `<span class="offense-badge badge text-bg-${offenseColor(data.offense)} float-end"> ${data.offense} </span>` : ''}
                                <h4 class="mb-3">
                                    <a href="${data.link}" target="_blank" class="link-danger">${data.id}</a> - ${data.title}
                                </h4>
                                <p class="lead mb-5">
                                    ${data.description || `<a href="${data.link}" target="_blank" class="link-danger">${data.link}</a>`}
                                </p>
                                ${parseDefinitions(data) || 'No description available.'}
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="col-4 rounded-end-4 bg-light-subtle">
                            <div class="card-body p-4">
                                ${generateSection('Elements of PC', data.elementsOfPC, formatListItem)}
                                ${data.relatedProcedures.length ? generateSection('Procedures', data.relatedProcedures, formatProcedure):''}
                                ${generateSection('Questions', data.questions, formatListItem, 'list-unstyled')}
                                ${generateSection('Related Codes', data.relatedCodes, formatListItem)}
                            </div>
                        </div>

                    </div>
                </div>`;
            // Assign HTML to the card element
            card.innerHTML = cardContent;

            rcwCards.appendChild(card);

            
            var test = document.querySelector(`[data-id="${data.id}"]`);
            test.scrollIntoView({behavior:'smooth'}); 


        }


        


        // Function to remove a card by ID
        function removeCodeCard(id) {
            const card = document.querySelector(`.rcw-card[data-id="${id}"]`);
            if (card) card.remove();
        }


        // Function to add a card for RCW or FWRC
        function addDirCard(data) {
            console.log('data ********************************');
            console.log(data);

            clearPages();

            const card = document.createElement('div');
            card.classList.add('col-12', 'rcw-card', 'mb-3');
            card.setAttribute('data-id', data.id);

            card.innerHTML = `
                <div class="card container border-1 border-secondary-subtle shadow-sm rounded-4">
                    <div class="row">
                        <div class="col">
                            <div class="card-body">
                                <p class="lead ${(keyExists(data,'notes'))?'mb-3':'mb-0'} fw-bold text-start">${data.name || 'No name available.'}</p>
                                ${(keyExists(data,'notes'))?'<p class=\"bg-light-subtle mb-0 p-3 rounded\"">'+data.notes+'</p>':''}
                            </div>
                        </div>
                        <div class="col rounded-end-4 ">
                            <div class="card-body">
                                <p class="lead mb-0 text-end">${data.phone || 'No name available.'}</p>                                
                            </div>
                        </div>
                    </div>
                </div>
            `;
            rcwCards.appendChild(card);
        }

        // Function to remove a card by ID
        function removeDirCard(id) {
            const card = document.querySelector(`.rcw-card[data-id="${id}"]`);
            if (card) card.remove();
        }




        const themeToggle = document.getElementById('themeToggle');
        const themeLabel = document.querySelector('.form-check-label');

        // Initialize the label based on the starting mode
        themeLabel.innerHTML = themeToggle.checked ? '<i class="bi bi-brightness-high"></i>' : '<i class="bi bi-moon-stars"></i>';

        themeToggle.addEventListener('change', () => {
            const newTheme = themeToggle.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-bs-theme', newTheme);
            themeLabel.innerHTML = newTheme === 'light' ? '<i class="bi bi-moon-stars"></i>' : '<i class="bi bi-brightness-high"></i>';
        });


        



            document.querySelectorAll('.accordion-button-page').forEach(button => {
                    button.addEventListener('click', (event) => {

                        const btn = event.target.closest(".accordion-button-page");
                        const pageid = btn.dataset.page;
                        
                        // Find the page by id
                        const page = pages.find(p => p.id === pageid);
                        if (page) {
                            console.log(page);
                            const data = JSON.parse(page.cards[0].data); // Assuming you want the `data` from the first card
                            addPage(page);
                        } else {
                            console.error("Page not found!");
                        }
                      
                    });
                });







                // Function to add a card for RCW or FWRC
        function addPage(data) {
            //console.log('data page ********************************');
            //console.log(data);

            // Clear all cards
            document.getElementById('clearSelections').click();
            rcwCards.innerHTML = '';


            const page = document.createElement('div');
            page.classList.add('row', 'rcw-page', 'mb-3');
            page.setAttribute('data-id', data.id);

            
            
            if (Array.isArray(data.cards)) {
                data.cards.forEach(item => {
                    var card = document.createElement('div');
                    card.classList.add('col-12', 'rcw-card', 'mb-3');
                    card.setAttribute('data-id', item.id);
                    card.innerHTML = `
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="p-4">
                                    <h2 class="display-6 mb-0">${item.title || ''}</h2>
                                    <p class="lead mb-5">${item.description || ''}</p>
                                    <div>${item.content}</div>
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                    `;
                    page.appendChild(card);
                });
            } else {
                console.error('Data cards is not an array:', data.cards);
            }

            
            rcwCards.appendChild(page);


            

        }

       
        document.addEventListener("DOMContentLoaded", function () {
                // Delegate click event to dynamically created buttons
                document.body.addEventListener("click", function (event) {
                    // Find the nearest parent element with the class "btn-jump"
                    const btnJump = event.target.closest(".btn-jump");

                    if (btnJump) {
                        event.preventDefault(); // Prevent default anchor behavior

                        const targetId = btnJump.getAttribute("href").substring(1); // Get the ID from the href (without the #)
                        const targetElement = document.getElementById(targetId); // Find the element with the matching ID

                        console.log(`Target ID: ${targetId}`); // Log the target ID for debugging

                        if (targetElement) {
                            targetElement.click(); // Trigger a click on the target element
                        }
                    }
                });

                // Load the start page on page ready
                document.querySelector('[data-page="1.0"]')?.click();


                
            });
            


    </script>

    <!-- <script>
// Function to extract content by ID
function extractContentById(html, containerId) {
    // Parse the HTML string into a DOM document
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // Find the container by ID
    const container = doc.getElementById(containerId);

    // Return the container's inner HTML or a message if not found
    if (container) {
        return container.innerHTML; // Extract inner content
    } else {
        return `No element with ID "${containerId}" found.`;
    }
}


        var proxy = 'https://api.codetabs.com/v1/proxy?quest=';
        fetch(proxy + 'https://app.leg.wa.gov/rcw/default.aspx?cite=9A.36.031')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Handle the response, e.g., convert it to text or JSON
                    return response.text();
                })
                .then(data => {
                    // Do something with the data from the webpage
                    //console.log(data);

                    // Use the function
const extractedContent = extractContentById(data, 'contentWrapper');

document.getElementById('contentTest').innerHTML = extractedContent;
console.log(extractedContent);
                })
                .catch(error => {
                    // Handle any errors that occurred during the fetch
                    console.error('There has been a problem with your fetch operation:', error);
                });
    </script> -->
</body>
</html>
